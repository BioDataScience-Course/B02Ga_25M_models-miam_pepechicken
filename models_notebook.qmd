---
title: "Analyses morphométriques de *Varanus salvator* afin de déterminer le sexe"
author: "Alexia Baire, Camille Spagna, Jeanne Curto, Lou Hallot"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
bibliography: references.bib
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but (que vous remanierez éventuellement en fonction des modèles que vous ajouterez plus tard). Vous pouvez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

Le but de ce projet est de déterminer le sexe des *Varanus salvator* à partir de mesures morphométriques diverses. Cependant, les mesures effectuées sont prises sur des varans issus de l'élevage à des fins de commerce de peau. Ces usines ont tendance à accepter des individus de moins de 5 kilos. Cela ne représente donc peut-être pas les conditions naturelles de détermination de sexe.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets du premier module de SDD II. -->

Au cours de ce projet, l'analyse des *Varanus Salvator* va être réalisée. Le jeu de donnée a été trouvé sur le site [Nature](https://www.nature.com/) dans la section Scientific data. Plus amples informations sur ce jeu de données ont été trouvées au sein de [@alymann2024].

La régression linéaire simple par les moindres carrés est utilisée pour modéliser les données. L'analyse est réalisée avec le logiciel R (`r R.version.string`) et en particulier le package {modelit} version `r packageVersion("modelit")` avec la [SciViews Box 2025](https://www.sciviews.org/software/svbox/) dans [Saturn Cloud](https://saturncloud.io/) (Linux Ubuntu 22.04). Le seuil $\alpha$ de tous les tests est fixé à l'avance à 5%.

## Analyses

```{r setup, include=FALSE}
# Ceci est nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))

# Configure Knitr to use AGG as graphic device
knitr::opts_chunk$set(dev = "ragg_png")

# Configuration de l'environnement
SciViews::R("model")
```

<!--% Importez les données que vous aurez préalablement nettoyées, remaniées et labélisées dans le script R nommé `R/import.R`. -->

```{r import}
# Lecture des données
lezards <- read("data/lezards.rds")

# Tableau des premières et dernières lignes
tabularise$headtail(lezards)
```

### Description des données

<!--% Chaque étudiant réalise et interprète un graphique pertinent en lien avec le but fixé et les modèles qui seront réalisés. Graphique et interprétation de l'étudiant #1 ci-dessous. -->

```{r chart1Alexia}
chart(data = lezards, circbasequeue ~ masse %col=% sexe_rec) +
  geom_point()+ 
  labs(col="Sexe")+
  stat_smooth(method = "lm", formula = y ~ x)+ 
  scale_color_brewer(palette = "Accent")
```

Le graphique montre que la circonférence de la base de la queue augmente avec la masse chez les deux sexes (mâle et femelle). Les points représentant les mâles sont globalement situés plus haut que ceux représentant les femelles pour une même masse. De même, la ligne de régression associée aux mâles reste au-dessus de celle des femelles sur l’ensemble des valeurs, indiquant que les mâles présentent des circonférences de base de queue plus élevées que les femelles dans cet échantillon. Il y a également un chevauchement entre les deux nuages de points, ainsi qu’une certaine dispersion des valeurs dans chaque groupe.

<!--% Graphique et interprétation de l'étudiant #2 ci-dessous. -->

```{r chart2Camille}
A <- chart(data = lezards, longtot ~ masse_rec_rec %fill=% sexe_rec) +
  geom_boxplot() +
  labs(fill = "Sexe", x = "Masse") +
  scale_fill_brewer(palette = "Accent")

B <- chart(data = lezards, longsansqueue ~ masse_rec_rec %fill=% sexe_rec) +
  geom_boxplot() +
  labs(fill = "Sexe", x = "Masse") +
  scale_fill_brewer(palette = "Accent")

combine_charts(list(A, B), common.legend = TRUE)
```

Pour une même masse, les mâles de *Varanus salvator* tendent à avoir une longueur totale plus élevée que les femelles, même si pour une masse légère, les mâles et les femelles ont une longueur totale similaire. À propos des longueurs sans la queue, la différence entre les longueurs sans queue des mâles et des femelles est beaucoup moins importante. Ceci montre que la différence de taille entre les différents sexes est surtout présente au niveau de la longueur de la queue.

<!--% Graphique et interprétation de l'étudiant #3 ci-dessous. -->

```{r chart3Jeanne}
chart(data=lezards, longtot ~ bodycond %col=% sexe_rec) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x) +
  labs(col = "Sexe") +
  scale_color_brewer(palette = "Accent")
```

Le graphique montre une augmentation de la longueur totale lorsque le rapport masse/longueur totale s'élève, et ce pour les deux sexes. La tendance est assez comparable chez les mâles et les femelles, bien que la ligne des mâles soit légèrement au dessus Les deux groupes restent fortement hétérogènes, présentant une grande variabilité dans leurs valeurs.

<!--% Graphique et interprétation de l'étudiant #4 ci-dessous. -->

```{r chart4Lou}
a <- chart(data = lezards, ~ largcrane %fill=% sexe_rec | sexe_rec) +
  geom_histogram(show.legend = FALSE, bins = 15) +
  ylab("Effectifs") +
  scale_fill_brewer(palette = "Accent")

b <- chart(data = lezards, ~ longcrane %fill=% sexe_rec | sexe_rec) +
    geom_histogram(show.legend = FALSE, bins = 15) +
  ylab("Effectifs") +
  scale_fill_brewer(palette = "Accent")

combine_charts(list(a, b))

```

La largeur et longueur du crâne des *Vanarus salvator* diffèrent entre les individus mâles et femelles : les mâles semblent avoir une largeur de crâne globalement centrée autour d’une valeur plus élevée que les femelles, qui présentent des valeurs plus basses d'au moins 1 centimètre dans les 2 variables. Ainsi les femelles ont en moyenne un crâne légèrement plus petit que les mâles, même si la variation reste importante dans les deux sexes.

### Modélisation

<!--% Chaque modèle doit être décrit à l'aide d'un graphique et d'un tableau résumant le modèle. Les équations paramétrées de tous les modèles doivent être également présentes. L'analyse des résidus sera réalisée et interprétée pour chaque modèle. -->

#### Régression linéaire 1

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r regressionlineaire1graphique}
chart(data = lezards, circbasequeue ~ masse %col=% sexe_rec) +
  geom_point()+ 
  labs(col="Sexe")+
  stat_smooth(method = "lm", formula = y ~ x)+ 
  scale_color_brewer(palette = "Accent") +
  labs(x="Masse [kg]")
```

Le graphique montre que la circonférence de la base de la queue augmente avec la masse chez les deux sexes (mâle et femelle). Les points représentant les mâles sont globalement situés plus haut que ceux représentant les femelles pour une même masse. De même, la ligne de régression associée aux mâles reste au-dessus de celle des femelles sur l’ensemble des valeurs, indiquant que les mâles présentent des circonférences de base de queue plus élevées que les femelles dans cet échantillon. Il y a également un chevauchement entre les deux nuages de points, ainsi qu’une certaine dispersion des valeurs dans chaque groupe.

```{r regressionlineaire1AlexiaetCamille}
lezards_lm1 <- lm(data= lezards, circbasequeue ~ masse * sexe_rec)
tabularise(summary_(lezards_lm1))
```

Ce modèle est trop complexe car on voit que $\beta_2$ et $\beta_3$ ne sont pas significativement différents de 0 au seuil $\alpha$ de 5%. Nous allons donc tenter de le simplifier.

```{r regressionlineaire1AlexiaetCamille1}
lezards_lm1_1 <- lm(data= lezards, circbasequeue ~ masse + sexe_rec)
tabularise(summary_(lezards_lm1_1))
```

Tous les paramètres sont significativement différents de 0 au seuil alpha de 5%. Le $R^2$ est de 0,62 ce qui montre que le modèle est relativement bon. De plus, la valeur de p est très inférieure à 0,05 ce qui signifie que le modèle est significatif.

```{r residuals1}
chart$residuals(lezards_lm1_1)
```

Les résidus sont importants par rapport à la plage de valeurs prédites. La linéarité est relativement bien respectée malgré la présence d'une valeur extrême.

Les résidus ont une distribution qui ne diffère pas trop de la Normale sauf aux extrémités.

Il y a homoscédasticité des résidus. Et toujours la présence d'une valeur extrême.

Un point a un effet de levier important ainsi qu'une distance de Cook importante mais ceci ne semble pas vraiement influencer le modèle.

$$
`r eq__(lezards_lm1, use_coefs = TRUE, coefs_digits = 3)`
$$

#### Régression linéaire 2

<!--% Ajustez une régression linéaire simple, multiple ou polynomiale par paire d'étudiants dans cette section (donc, deux modèles pour l'équipe de quatre). -->

```{r graphiqueregressionlineaire2}
chart(data=lezards, longcrane ~ largcrane) +
  geom_point()+
  stat_smooth(method="lm", formula = y ~ x)
```

Une relation linéaire est observée, les points sont relativement proches de la droite. Plus la largeur du crâne augmente, plus la longueur du crâne augmente.

```{r regressionlineaire2JeanneetLou}
lezards_lm2 <- lm(data = lezards, longcrane ~ largcrane)
tabularise(summary_(lezards_lm2))
```

La valeur de l’ordonnée à l’origine et de la pente sont significativement différentes de zéro au seuil alpha de 5%. Le $R^2$ est d'environ 0,76, traduisant un bon modèle. Il en est de même pour la valeur de p, étant inférieure à 0,05, indiquant que le modèle est significatif.

```{r {r residuals2}
chart$residuals(lezards_lm2)
```

Les résidus se répartissent de manière équilibrée et linéaire.

Les résidus suivent une distribution Normale.

Le graphique de la variance des résidus vérifie l'homoscédasticité.

Aucune valeur n’influence trop fortement la régression linéaire.

$$
`r eq__(lezards_lm2, use_coefs = TRUE, coefs_digits = 3)`
$$

#### Modèle linéaire 1

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r modelelineairegraphique1}
a <- chart(data=lezards, circbasequeue ~ masse %col=% sexe_rec) +
  geom_point()+
  stat_smooth(method="lm", formula = y ~ x)+
  scale_color_brewer(palette = "Accent")+
  labs(x="Masse [Kg]", col = "Sexe")

b <- chart(data=lezards, circbasequeue ~ longqueue %col=% sexe_rec) +
  geom_point()+
  stat_smooth(method="lm", formula = y ~ x)+
  scale_color_brewer(palette = "Accent")+
  labs(col = "Sexe")

combine_charts(list(a, b), common.legend = TRUE)
```

Dans le premier graphique, on observe que lorsque la masse augmente, la circonférence de la base de la queue augmente également, aussi bien chez les mâles que chez les femelles. Le second graphique montre la même tendance avec la longueur de la queue. Plus elle est grande, plus la circonférence de la base de la queue est importante. Dans l’ensemble, les mâles présentent des circonférences légèrement supérieures à celles des femelles pour des valeurs équivalentes de masse ou de longueur de la queue, mais la progression reste parallèle entre les deux sexes.

```{r modelelineaire1AlexiaetCamille}
lezards_ml1 <- lm(data= lezards, circbasequeue ~ (masse + longqueue) * sexe_rec)
tabularise(summary_(lezards_ml1))
```

Les paramètres $\alpha$, $\beta_1$ et $\beta_2$ sont significativement différents de 0 au seuil $\alpha$ de 5%, tandis que les paramètres $\beta_3$, $\beta_4$ et $\beta_5$ ne le sont pas. Nous allons donc tenter de simplifier le modèle et de supprimer les interactions.

```{r}
lezards_ml1_1 <- lm(data= lezards, circbasequeue ~ masse + longqueue + sexe_rec)
tabularise(summary_(lezards_ml1_1))
```

Tous les paramètres sont significativement différents de 0 au seuil $\alpha$ de 5%, sauf le paramètre $\beta_2$ dont la valeur de p est égale à 0,05. Le $R^2$ est de 0,63 ce qui montre que le modèle est relativement bon. De plus, la valeur de p est très inférieure à 0,05 ce qui signifie que le modèle est significatif.

```{r residuals2}
chart$residuals(lezards_ml1)
```

L'étendue des résidus est similaire par rapport aux valeurs prédites. La linéarité est relativement bien respectée malgré la présence d'une valeur extrême.

Les résidus ont une distribution qui ne diffère pas trop de la Normale sauf aux extrémités.

Il y a homoscédasticité des résidus. Et toujours la présence d'une valeur extrême.

Un point a un effet de levier important ainsi qu'une distance de Cook importante mais ceci ne semble pas fortement influencer le modèle.

$$
`r eq__(lezards_ml1, use_coefs = TRUE, coefs_digits = 3)`
$$

#### Modèle linéaire 2

<!--% Construisez un modèle linéaire par paire d'étudiants dans cette section. -->

```{r modelelineairegraphique2}
chart(data=lezards, longcrane ~ largcrane %col=% sexe_rec) +
  geom_point()+
  labs(col="Sexe")+
  stat_smooth(method = "lm", formula = y ~ x)+ 
  scale_color_brewer(palette = "Accent")
```

Interprétation...

```{r}
lezards_ml2 <- lm(data = lezards, largcrane ~ longcrane * sexe)
tabularise(summary_(lezards_ml2))
```

Ce modèle semble correct car tous les paramètres sont significativement différents de à au seuil $\alpha$ de 5%. De plus, le $R^2$ est d'environ 0,78 traduisant un bon modèle. Il en est de même pour la valeur de p, étant inférieure à 0,05, indiquant que le modèle est significatif. Cependant, il serait intéressant de voir s'il la largeur du crâne a une interaction plus forte avec le sexe que la longueur.

```{r modelelineaire2JeanneetLou}
lezards_ml2_1 <- lm(data = lezards, longcrane ~ largcrane * sexe)
tabularise(summary_(lezards_ml2_1))
```

De nouveau, pour ce modèle, les paramètres sont significativement différents de zéro au seuil $\alpha$ de 5%. Le $R^2$ est d'environ 0,77, très faiblement inférieur au précédent (0,78) mais traduis tout de même d'un bon modèle. Il en est de même pour la valeur de p, étant inférieure à 0,05, indiquant que le modèle est significatif.

```{r}
AIC(lezards_ml2,lezards_ml2_1)
```

Grâce à cette comparaison des modèles, nous voyons plus clairement que le deuxième modèle, c'est-à-dire l'interaction entre la largeur du crâne et le sexe, est plus intéressant.

```{r residuals3}
chart$residuals(lezards_ml2)
```

Les résidus se répartissent de manière équilibrée et linéaire.

Les résidus suivent une distribution Normale.

Le graphique de la variance des résidus vérifie l'homoscédasticité.

Aucune valeur n’influence trop fortement la régression linéaire.

$$
`r eq__(lezards_ml2, use_coefs = TRUE, coefs_digits = 3)`
$$

#### Modèle linéaire généralisé et/ou mixte 1

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r modelelineairegeneraliseet/oumixte1AlexiaetCamille}
lezards_mlg1_1 <-glm(data = lezards, masse ~ (cbq_lt + lq_lt)*sexe_rec, family=gaussian)
tabularise(summary_(lezards_mlg1_1))
```

Aucun paramètre n'est significativement différent de 0 au seuil $\alpha$ de 5%. Nous allons donc simplifier ce modèle en supprimant l'interaction avec le sexe et en modifiant la variable réponse.

```{r}
lezards_mlg1 <- glm(data = lezards, sexe_rec ~ cbq_lt + lq_lt + masse, family=binomial)
tabularise(summary_(lezards_mlg1))
```

Les paramètres $\alpha$, $\beta_1$ et $\beta_2$ sont significativement différents de 0 au seuil $\alpha$ de 5%, tandis que le paramètre $\beta_3$ ne l'est pas. Nous allons de nouveau tenter de simplifier le modèle et de supprimer le facteur masse.

```{r}
lezards_mlg1_2 <- glm(data = lezards, sexe_rec ~ cbq_lt + lq_lt, family=binomial)
tabularise(summary_(lezards_mlg1_2))
```

Tous les paramètres sont significativement différents de 0 au seuil $\alpha$ de 5%. La déviance des résidus est de 1,25 ce qui est plutôt proche de 1. Ceci signifierait qu'il n'y a pas de surdispersion.

#### Modèle linéaire généralisé et/ou mixte 2

<!--% Élaborez un modèle linéaire généralisé ou mixte par paire d'étudiants dans cette section. -->

```{r}
lezards_mlg2 <- glm(data = lezards, sexe_rec ~ largcrane + longcrane, family = binomial)
tabularise(summary_(lezards_mlg2))
```

Aucun paramètre n'est différent de 0 au seuil $\alpha$ de 5%. Nous allons donc essayer un modèle plus complexe.

```{r modelelineairegeneraliseetoumixte1JeanneetLou}
lezards_mlg2_1 <- glm(data = lezards, sexe_rec ~ largcrane * longcrane, family = binomial)
tabularise(summary_(lezards_mlg2_1))
```

Désormais, tous les paramètres sont significativement différents de 0 au seuil $\alpha$ de 5%. La déviance des résidus est de 1,3, cette valeur est assez proche de 1, il n'y a de surdispersion et il ne faut donc pas réajuster le paramètre de dispersion. On voit également que le critère d'Akaike ici est de 199,6 précédemment de 203,5, ce qui favorise ce modèle.

$$
`r eq__(lezards_mlg2, use_coefs = TRUE, coefs_digits = 3)`
$$

```{r AIC}
AIC(lezards_lm1_1, lezards_lm2, lezards_ml1_1, lezards_ml2, lezards_mlg1_2, lezards_mlg2, lezards_mlg2_1)
```

Selon le critère d'Akaike, les deux meilleurs modèles sont la régression linéaire 2 et le modèle linéaire 2.

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les modèles les plus pertinents que vous retenez ? -->

...vos conclusions ici...

## Références

<!--% N'indiquez rien ci-dessous. Quarto se chargera de rajouter vos références bibliographiques automatiquement. -->
